<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Banner Generator - More Compact</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Chewy&family=Cabin:wght@400;700&display=swap" rel="stylesheet"/>
  <style>
    html { font-size: 100%; }
    body {
      font-family: 'Cabin', sans-serif;
      background-color: #f0f4f8;
    }
    .title-font {
      font-family: 'Chewy', cursive;
    }
    .form-section { margin-bottom: 1.5rem; }
    .form-section h3 { font-size: 1.25rem; font-weight: bold; margin-bottom: 0.5rem; color: #2d3748; }
    .form-section label { display: block; margin-bottom: 0.25rem; font-weight: 500; color: #4a5568; }
    .form-section input[type="text"],
    .form-section input[type="date"],
    .form-section input[type="time"],
    .form-section select {
      width: 100%; padding: 0.5rem; border: 1px solid #cbd5e0; border-radius: 0.25rem; box-sizing: border-box;
    }
    .form-section input[type="file"] { width: 100%; padding: 0.35rem; }
    #preview-display-area {
        width: 100%;
        max-width: 960px;
        margin: 0 auto;
        overflow: hidden;
    }
    #banner-scaler {
        width: 960px;
        transform-origin: top left;
        background-color: #ccc;
    }
    #banner-content {
        width: 960px;
        /* Try to keep min-height around the target aspect ratio height */
        min-height: 500px; /* Aiming for a default render around 500-540px */
        font-family: 'Cabin', sans-serif;
        position: relative;
    }
    .theme-swatch {
        width: 30px; height: 30px; border-radius: 50%; cursor: pointer;
        border: 2px solid white; box-shadow: 0 0 5px rgba(0,0,0,0.2);
        transition: transform 0.1s ease-in-out;
    }
    .theme-swatch:hover { transform: scale(1.1); }
    .theme-swatch.active-theme { border-color: #3498db; box-shadow: 0 0 8px rgba(52, 152, 219, 0.7); }
    #theme-selector-container { max-height: 200px; overflow-y: auto; padding: 5px; background-color: #e9ecef; border-radius: 4px; }
  </style>
</head>
<body class="text-gray-800">

  <div class="container mx-auto p-4 md:p-8">
    <header class="text-center mb-8">
      <h1 class="text-3xl md:text-4xl font-bold text-gray-700">Workshop Banner Generator</h1>
    </header>

    <div class="flex flex-col md:flex-row gap-8">
      <!-- Form Column (Same as before) -->
      <div class="w-full md:w-1/3 bg-white p-6 rounded-lg shadow-md">
        <form id="banner-form">
            <div class="form-section">
                <h3>General Info</h3>
                <label for="title">Title:</label>
                <input type="text" id="title" value="Do-It-Yourself Brain Surgery">
                <label for="subtitle" class="mt-2">Subtitle/Tagline:</label>
                <input type="text" id="subtitle" value="Letting Go and Embracing the Unexpected">
                <label for="workshopBy" class="mt-2">Workshop By:</label>
                <input type="text" id="workshopBy" value="Impro Neuf">
                <label for="language" class="mt-2">Language:</label>
                <input type="text" id="language" value="English">
            </div>
            <div class="form-section">
                <h3>Host(s)</h3>
                <label for="numHosts">Number of Hosts:</label>
                <select id="numHosts" class="mb-2"> <option value="1">1 Host</option> <option value="2" selected>2 Hosts</option> </select>
                <div id="host1-details">
                    <label for="host1Name">Host 1 Name:</label> <input type="text" id="host1Name" value="Sondre Jensen">
                    <label for="host1Image" class="mt-1">Host 1 Image:</label> <input type="file" id="host1Image" accept="image/*">
                </div>
                <div id="host2-details" class="mt-3">
                    <label for="host2Name">Host 2 Name:</label> <input type="text" id="host2Name" value="Eva Steffensen">
                    <label for="host2Image" class="mt-1">Host 2 Image:</label> <input type="file" id="host2Image" accept="image/*">
                </div>
            </div>
            <div class="form-section">
                <h3>Event Details</h3>
                <label for="eventDate">Date:</label> <input type="text" id="eventDate" value="Wednesday, May 28, 2025">
                <label for="eventTime" class="mt-2">Time:</label> <input type="text" id="eventTime" value="6:00 PM ‚Äì 8:00 PM">
                <label for="location" class="mt-2">Location:</label> <input type="text" id="location" value="Chateau Neuf">
                <label for="room" class="mt-2">Room:</label> <input type="text" id="room" value="Betong">
            </div>
            <div class="form-section">
                <h3>Branding & CTA</h3>
                <label for="logoImage">Logo Image (optional):</label> <input type="file" id="logoImage" accept="image/*">
                <label for="signupText" class="mt-2">Sign Up Text:</label> <input type="text" id="signupText" value="Sign up now!">
            </div>
            <div class="form-section">
                <h3>Theme</h3>
                <div id="theme-selector-container"> <div id="theme-selector" class="grid grid-cols-6 md:grid-cols-8 gap-2"></div> </div>
            </div>
            <div class="form-section">
                <h3>Download</h3>
                <button type="button" id="downloadFacebookBtn" class="w-full bg-green-600 hover:bg-green-800 text-white font-bold py-2 px-4 rounded mb-2">Download Facebook (1920x1005)</button>
                <button type="button" id="downloadMeetupBtn" class="w-full bg-teal-500 hover:bg-teal-700 text-white font-bold py-2 px-4 rounded">Download Meetup/SiO (1920x1080)</button>
            </div>
        </form>
      </div>

      <!-- Preview Column -->
      <div class="w-full md:w-2/3"> <!-- Removed flex and alignment from this outer container -->
        <div class="md:sticky md:top-8 flex flex-col items-center md:items-start"> <!-- Added sticky positioning and re-added flex for inner content -->
          <p class="text-sm text-gray-600 mb-2 text-center md:text-left">Preview (scales to fit, content can grow vertically):</p>
          <div id="preview-display-area" class="shadow-lg">
              <div id="banner-scaler">
                  <!-- **FURTHER MODIFIED FOR MORE COMPACTNESS** -->
                  <!-- Overall padding reduced py-6 (was py-8) -->
                  <div id="banner-content" class="flex flex-col items-center justify-center px-6 py-6">
                      <!-- Logo -->
                      <div class="absolute top-3 right-3"> <!-- top-3 right-3 (was top-4 right-4) -->
                        <img id="preview-logo" src="placeholder-logo.png" alt="Logo" class="w-12 md:w-16 hidden"/> <!-- Remains w-12 md:w-16 -->
                      </div>

                      <!-- Title -->
                      <!-- text-4xl (no md variant needed if space is tight), leading-tight added -->
                      <h1 id="preview-title" class="text-4xl title-font drop-shadow-md text-center leading-tight">
                        Do-It-Yourself Brain Surgery
                      </h1>

                      <!-- Subtitle / Tagline -->
                      <!-- text-lg, mt-2 (was mt-3), leading-snug -->
                      <h2 id="preview-subtitle" class="text-lg mt-2 font-bold text-center leading-snug">
                        Letting Go and Embracing the Unexpected
                      </h2>

                      <!-- ‚Äúwith‚Äù label -->
                      <!-- text-base (was md), mt-3 (was mt-4) -->
                      <p id="with-label" class="mt-3 text-base font-semibold">
                      with</p>

                      <!-- Hosts -->
                      <!-- text-xl (no md variant), mt-1, space-x-2 (was space-x-3) -->
                      <div id="preview-hosts-container" class="flex items-center justify-center mt-1 space-x-2 text-xl title-font">
                        <span id="preview-host1Name">Sondre Jensen</span>
                        <span id="preview-host-ampersand">&</span>
                        <span id="preview-host2Name">Eva Steffensen</span>
                      </div>

                      <!-- Host Images -->
                      <!-- mt-4 (was mt-6), space-x-3 (was space-x-4) -->
                      <!-- w-28 h-28 (was w-32 h-32) -->
                      <div id="preview-host-images-container" class="flex items-center justify-center mt-4 space-x-3">
                        <img id="preview-host1Image" src="placeholder-person.png" alt="Host 1" class="w-28 h-28 rounded-full border-2 md:border-4 shadow-lg"/>
                        <img id="preview-host2Image" src="placeholder-person.png" alt="Host 2" class="w-28 h-28 rounded-full border-2 md:border-4 shadow-lg"/>
                      </div>

                      <!-- Free Workshop Note -->
                      <!-- text-base (was md), mt-3 (was mt-4) -->
                      <p id="workshop-note" class="mt-3 text-base font-bold">
                        A free <span id="preview-language">English</span> open workshop by <span id="preview-workshopBy">Impro Neuf</span>.
                      </p>

                      <!-- Workshop Info -->
                      <!-- text-base (was md), mt-4 (was mt-6), space-y-1 (was space-y-2) -->
                      <div id="workshop-info" class="mt-4 text-center text-base space-y-1">
                        <p>üìÖ <span class="font-bold detail-label">Date:</span> <span id="preview-eventDate">Wednesday, May 28, 2025</span></p>
                        <p>‚è∞ <span class="font-bold detail-label">Time:</span> <span id="preview-eventTime">6:00 PM ‚Äì 8:00 PM</span></p>
                        <p>üìç <span class="font-bold detail-label">Location:</span> <span id="preview-location">Chateau Neuf</span></p>
                        <p>üè¢ <span class="font-bold detail-label">Room:</span> <span id="preview-room">Betong</span></p>
                      </div>

                      <!-- Sign Up Call -->
                      <!-- text-xl (no md variant), mt-4 (was mt-6) -->
                      <p id="preview-signupText" class="mt-4 text-xl font-bold title-font">
                        Sign up now!
                      </p>
                  </div>
              </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="theme-name-tooltip" class="fixed hidden bg-gray-800 text-white text-xs rounded py-1 px-2 shadow-lg z-50 pointer-events-none" style="transition: opacity 0.1s ease-in-out;"></div>

<script>
  // --- THEME DEFINITIONS --- (Keep your existing themes array)
  const themes = [
    // ... (your full themes array here) ...
    {
      name: "Oddly Specific Orange",
      id: "oddly-specific-orange",
      bgGradient: "radial-gradient(circle, #fb8c00, #5d1a00)",
      primaryText: "#FFFFFF",
      secondaryText: "#fef08a",
      accentText: "#fde047",
      hostBorder: "#fde047",
      swatchColor: "#fb8c00"
    },
    {
      name: "Cosmic Grape",
      id: "cosmic-grape",
      bgGradient: "radial-gradient(circle, #ab47bc, #4a148c)",
      primaryText: "#FFFFFF",
      secondaryText: "#f3e5f5",
      accentText: "#e1bee7",
      hostBorder: "#ce93d8",
      swatchColor: "#ab47bc"
    },
    {
      name: "Electric Teal",
      id: "electric-teal",
      bgGradient: "radial-gradient(circle, #26a69a, #004d40)",
      primaryText: "#FFFFFF",
      secondaryText: "#e0f2f1",
      accentText: "#b2dfdb",
      hostBorder: "#80cbc4",
      swatchColor: "#26a69a"
    },
    {
      name: "Ruby Flare",
      id: "ruby-flare",
      bgGradient: "radial-gradient(circle, #ef5350, #c62828)",
      primaryText: "#FFFFFF",
      secondaryText: "#ffebee",
      accentText: "#ffcdd2",
      hostBorder: "#ef9a9a",
      swatchColor: "#ef5350"
    },
    {
      name: "Forest Glow",
      id: "forest-glow",
      bgGradient: "radial-gradient(circle, #66bb6a, #2e7d32)",
      primaryText: "#FFFFFF",
      secondaryText: "#e8f5e9",
      accentText: "#c8e6c9",
      hostBorder: "#a5d6a7",
      swatchColor: "#66bb6a"
    },
    {
      name: "Midnight Sapphire",
      id: "midnight-sapphire",
      bgGradient: "radial-gradient(circle, #42a5f5, #1565c0)",
      primaryText: "#FFFFFF",
      secondaryText: "#e3f2fd",
      accentText: "#bbdefb",
      hostBorder: "#90caf9",
      swatchColor: "#42a5f5"
    },
    {
      name: "Sunset Vivid",
      id: "sunset-vivid",
      bgGradient: "radial-gradient(circle, #ff7043, #d84315)",
      primaryText: "#FFFFFF",
      secondaryText: "#fff3e0",
      accentText: "#ffccbc",
      hostBorder: "#ffab91",
      swatchColor: "#ff7043"
    },
    { name: "Surgical Green", id: "surgical-green", bgGradient: "radial-gradient(circle, #1b5e20, #66bb6a)", primaryText: "#FFFFFF", secondaryText: "#a5d6a7", accentText: "#c8e6c9", hostBorder: "#81c784", swatchColor: "#66bb6a" },
    { name: "Forest Mist", id: "forest-mist", bgGradient: "radial-gradient(circle, #2e7d32, #a5d6a7)", primaryText: "#FFFFFF", secondaryText: "#e8f5e9", accentText: "#c8e6c9", hostBorder: "#a5d6a7", swatchColor: "#2e7d32" },
    { name: "Deep Blue", id: "deep-blue", bgGradient: "radial-gradient(circle, #0d47a1, #42a5f5)", primaryText: "#FFFFFF", secondaryText: "#90caf9", accentText: "#bbdefb", hostBorder: "#64b5f6", swatchColor: "#42a5f5" },
    { name: "Ocean Breeze", id: "ocean-breeze", bgGradient: "radial-gradient(circle, #0277bd, #81d4fa)", primaryText: "#FFFFFF", secondaryText: "#e1f5fe", accentText: "#b3e5fc", hostBorder: "#4fc3f7", swatchColor: "#0277bd" },
    { name: "Midnight Sky", id: "midnight-sky", bgGradient: "radial-gradient(circle, #1a237e, #5c6bc0)", primaryText: "#FFFFFF", secondaryText: "#c5cae9", accentText: "#e8eaf6", hostBorder: "#9fa8da", swatchColor: "#1a237e" },
    { name: "Sunset Orange", id: "sunset-orange", bgGradient: "radial-gradient(circle, #e65100, #ffb74d)", primaryText: "#FFFFFF", secondaryText: "#ffcc80", accentText: "#ffe0b2", hostBorder: "#ffca28", swatchColor: "#e65100" },
    { name: "Fiery Red", id: "fiery-red", bgGradient: "radial-gradient(circle, #b71c1c, #ef5350)", primaryText: "#FFFFFF", secondaryText: "#ffcdd2", accentText: "#ffebee", hostBorder: "#e57373", swatchColor: "#b71c1c" },
    { name: "Golden Hour", id: "golden-hour", bgGradient: "radial-gradient(circle, #ff8f00, #ffd54f)", primaryText: "#212121", secondaryText: "#424242", accentText: "#757575", hostBorder: "#ffc107", swatchColor: "#ff8f00" },
    { name: "Royal Purple", id: "royal-purple", bgGradient: "radial-gradient(circle, #4a148c, #ab47bc)", primaryText: "#FFFFFF", secondaryText: "#e1bee7", accentText: "#f3e5f5", hostBorder: "#ba68c8", swatchColor: "#4a148c" },
    { name: "Magenta Magic", id: "magenta-magic", bgGradient: "radial-gradient(circle, #880e4f, #ec407a)", primaryText: "#FFFFFF", secondaryText: "#f8bbd0", accentText: "#fce4ec", hostBorder: "#f06292", swatchColor: "#880e4f" },
    { name: "Lavender Dream", id: "lavender-dream", bgGradient: "radial-gradient(circle, #5e35b1, #b39ddb)", primaryText: "#FFFFFF", secondaryText: "#ede7f6", accentText: "#d1c4e9", hostBorder: "#9575cd", swatchColor: "#5e35b1" },
    { name: "Charcoal", id: "charcoal", bgGradient: "radial-gradient(circle, #263238, #78909c)", primaryText: "#FFFFFF", secondaryText: "#cfd8dc", accentText: "#eceff1", hostBorder: "#90a4ae", swatchColor: "#263238" },
    { name: "Silver Stone", id: "silver-stone", bgGradient: "radial-gradient(circle, #616161, #bdbdbd)", primaryText: "#FFFFFF", secondaryText: "#f5f5f5", accentText: "#eeeeee", hostBorder: "#e0e0e0", swatchColor: "#616161" },
    { name: "Warm Earth", id: "warm-earth", bgGradient: "radial-gradient(circle, #5d4037, #bcaaa4)", primaryText: "#FFFFFF", secondaryText: "#d7ccc8", accentText: "#efebe9", hostBorder: "#a1887f", swatchColor: "#5d4037" },
    { name: "Terracotta", id: "terracotta", bgGradient: "radial-gradient(circle, #bf360c, #ff8a65)", primaryText: "#FFFFFF", secondaryText: "#ffccbc", accentText: "#fbe9e7", hostBorder: "#ffab91", swatchColor: "#bf360c" },
    { name: "Teal & Orange", id: "teal-orange", bgGradient: "radial-gradient(circle, #00695c, #ff9800)", primaryText: "#FFFFFF", secondaryText: "#80cbc4", accentText: "#e0f2f1", hostBorder: "#ffb74d", swatchColor: "#00695c" },
    { name: "Purple & Yellow", id: "purple-yellow", bgGradient: "radial-gradient(circle, #6a1b9a, #fdd835)", primaryText: "#FFFFFF", secondaryText: "#e1bee7", accentText: "#fff9c4", hostBorder: "#fbc02d", swatchColor: "#6a1b9a" },
    { name: "Blue & Pink", id: "blue-pink", bgGradient: "radial-gradient(circle, #1565c0, #f06292)", primaryText: "#FFFFFF", secondaryText: "#bbdefb", accentText: "#f8bbd0", hostBorder: "#ce93d8", swatchColor: "#1565c0" },
    { name: "Green & Gold", id: "green-gold", bgGradient: "radial-gradient(circle, #2e7d32, #fbc02d)", primaryText: "#FFFFFF", secondaryText: "#a5d6a7", accentText: "#fff59d", hostBorder: "#ffee58", swatchColor: "#2e7d32"},
    { name: "Crimson Night", id: "crimson-night", bgGradient: "radial-gradient(circle, #900C3F, #212121)", primaryText: "#FFEBEE", secondaryText: "#F8BBD0", accentText: "#E0E0E0", hostBorder: "#C2185B", swatchColor: "#900C3F"},
    { name: "Emerald Water", id: "emerald-water", bgGradient: "radial-gradient(circle, #004D40, #4DB6AC)", primaryText: "#E0F2F1", secondaryText: "#B2DFDB", accentText: "#FFFFFF", hostBorder: "#80CBC4", swatchColor: "#004D40"},
    { name: "Ruby Red", id: "ruby-red", bgGradient: "radial-gradient(circle, #6A0000, #D32F2F)", primaryText: "#FFEBEE", secondaryText: "#FFCDD2", accentText: "#FFFFFF", hostBorder: "#E57373", swatchColor: "#6A0000"},
    { name: "Sapphire Blue", id: "sapphire-blue", bgGradient: "radial-gradient(circle, #0D47A1, #42A5F5)", primaryText: "#E3F2FD", secondaryText: "#BBDEFB", accentText: "#FFFFFF", hostBorder: "#90CAF9", swatchColor: "#0D47A1"},
    { name: "Amethyst Purple", id: "amethyst-purple", bgGradient: "radial-gradient(circle, #311B92, #7E57C2)", primaryText: "#EDE7F6", secondaryText: "#D1C4E9", accentText: "#FFFFFF", hostBorder: "#B39DDB", swatchColor: "#311B92"},
    { name: "Citrus Burst", id: "citrus-burst", bgGradient: "radial-gradient(circle, #FF6F00, #FFCA28)", primaryText: "#212121", secondaryText: "#616161", accentText: "#424242", hostBorder: "#FFD54F", swatchColor: "#FF6F00"},
    { name: "Mocha Delight", id: "mocha-delight", bgGradient: "radial-gradient(circle, #3E2723, #8D6E63)", primaryText: "#EFEBE9", secondaryText: "#D7CCC8", accentText: "#FFFFFF", hostBorder: "#BCAAA4", swatchColor: "#3E2723"},
    { name: "Graphite Gray", id: "graphite-gray", bgGradient: "radial-gradient(circle, #212121, #757575)", primaryText: "#FAFAFA", secondaryText: "#E0E0E0", accentText: "#BDBDBD", hostBorder: "#9E9E9E", swatchColor: "#212121"},
    { name: "Spring Meadow", id: "spring-meadow", bgGradient: "radial-gradient(circle, #558B2F, #AED581)", primaryText: "#1B5E20", secondaryText: "#33691E", accentText: "#F1F8E9", hostBorder: "#C5E1A5", swatchColor: "#558B2F"},
    { name: "Coral Reef", id: "coral-reef", bgGradient: "radial-gradient(circle, #FF4500, #FFAB91)", primaryText: "#FFFFFF", secondaryText: "#FFE0B2", accentText: "#FFF3E0", hostBorder: "#FF8A65", swatchColor: "#FF4500"},
    { name: "Arctic Blue", id: "arctic-blue", bgGradient: "radial-gradient(circle, #01579B, #81D4FA)", primaryText: "#E1F5FE", secondaryText: "#B3E5FC", accentText: "#FFFFFF", hostBorder: "#4FC3F7", swatchColor: "#01579B"}
  ];
  let currentTheme = themes[0];
  const LOCAL_STORAGE_KEY = 'bannerGeneratorFormData';
  let themeNameTooltip; // <<< NEW: For tooltip element

  document.addEventListener('DOMContentLoaded', () => {
    themeNameTooltip = document.getElementById('theme-name-tooltip'); // <<< NEW: Initialize tooltip element
    const bannerScaler = document.getElementById('banner-scaler');
    const bannerContent = document.getElementById('banner-content');
    const previewDisplayArea = document.getElementById('preview-display-area');
    const themeSelectorDiv = document.getElementById('theme-selector');

    const formInputs = {
        title: document.getElementById('title'), subtitle: document.getElementById('subtitle'),
        workshopBy: document.getElementById('workshopBy'), language: document.getElementById('language'),
        numHosts: document.getElementById('numHosts'), host1Name: document.getElementById('host1Name'),
        host1Image: document.getElementById('host1Image'), host2Name: document.getElementById('host2Name'),
        host2Image: document.getElementById('host2Image'), eventDate: document.getElementById('eventDate'),
        eventTime: document.getElementById('eventTime'), location: document.getElementById('location'),
        room: document.getElementById('room'), logoImage: document.getElementById('logoImage'),
        signupText: document.getElementById('signupText')
    };

    const previewElements = {
        title: document.getElementById('preview-title'), subtitle: document.getElementById('preview-subtitle'),
        workshopBy: document.getElementById('preview-workshopBy'), language: document.getElementById('preview-language'),
        host1Name: document.getElementById('preview-host1Name'), host2Name: document.getElementById('preview-host2Name'),
        ampersand: document.getElementById('preview-host-ampersand'), host1Image: document.getElementById('preview-host1Image'),
        host2Image: document.getElementById('preview-host2Image'), eventDate: document.getElementById('preview-eventDate'),
        eventTime: document.getElementById('preview-eventTime'), location: document.getElementById('preview-location'),
        room: document.getElementById('preview-room'), logo: document.getElementById('preview-logo'),
        signupText: document.getElementById('preview-signupText'), withLabel: document.getElementById('with-label'),
        hostImagesContainer: document.getElementById('preview-host-images-container'),
        workshopNote: document.getElementById('workshop-note'),
        detailLabels: document.querySelectorAll('#workshop-info .detail-label')
    };

    const placeholderPerson = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23cccccc'%3E%3C/rect%3E%3Ctext x='50' y='55' font-family='Arial' font-size='12' text-anchor='middle' fill='%23555555'%3Eperson%3C/text%3E%3C/svg%3E";
    const placeholderLogo = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23dddddd'%3E%3C/rect%3E%3Ctext x='50' y='55' font-family='Arial' font-size='12' text-anchor='middle' fill='%23666666'%3Elogo%3C/text%3E%3C/svg%3E";

    previewElements.host1Image.src = placeholderPerson;
    previewElements.host2Image.src = placeholderPerson;
    previewElements.logo.src = placeholderLogo;
    previewElements.logo.classList.add('hidden');

    function saveFormData() {
        const dataToSave = {};
        for (const key in formInputs) {
            if (formInputs[key].type !== 'file') {
                dataToSave[key] = formInputs[key].value;
            }
        }
        if (previewElements.host1Image.src !== placeholderPerson && previewElements.host1Image.src.startsWith('data:image')) {
            dataToSave.host1ImageData = previewElements.host1Image.src;
        }
        if (previewElements.host2Image.src !== placeholderPerson && previewElements.host2Image.src.startsWith('data:image')) {
            dataToSave.host2ImageData = previewElements.host2Image.src;
        }
        if (previewElements.logo.src !== placeholderLogo && previewElements.logo.src.startsWith('data:image') && !previewElements.logo.classList.contains('hidden')) {
            dataToSave.logoImageData = previewElements.logo.src;
        }
        dataToSave.selectedThemeId = currentTheme.id;
        localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(dataToSave));
    }

    function loadFormData() {
        const savedData = localStorage.getItem(LOCAL_STORAGE_KEY);
        if (savedData) {
            const parsedData = JSON.parse(savedData);
            for (const key in formInputs) {
                if (formInputs[key].type !== 'file' && parsedData[key] !== undefined) {
                    formInputs[key].value = parsedData[key];
                }
            }
            if (parsedData.host1ImageData) previewElements.host1Image.src = parsedData.host1ImageData;
            if (parsedData.host2ImageData) previewElements.host2Image.src = parsedData.host2ImageData;
            if (parsedData.logoImageData) {
                previewElements.logo.src = parsedData.logoImageData;
                previewElements.logo.classList.remove('hidden');
            } else {
                 previewElements.logo.src = placeholderLogo;
                 previewElements.logo.classList.add('hidden');
            }
            if (parsedData.selectedThemeId) {
                const foundTheme = themes.find(t => t.id === parsedData.selectedThemeId);
                if (foundTheme) currentTheme = foundTheme;
            }
        }
    }

    // <<< NEW: Function to ONLY apply visual styles (for hover)
    function _applyThemeStyles(theme) {
        bannerContent.style.background = theme.bgGradient;
        previewElements.title.style.color = theme.primaryText;
        previewElements.host1Name.style.color = theme.primaryText;
        previewElements.host2Name.style.color = theme.primaryText;
        previewElements.ampersand.style.color = theme.primaryText;
        previewElements.signupText.style.color = theme.primaryText;
        previewElements.subtitle.style.color = theme.secondaryText;
        previewElements.withLabel.style.color = theme.accentText;
        previewElements.workshopNote.style.color = theme.accentText;
        previewElements.language.style.color = theme.accentText;
        previewElements.workshopBy.style.color = theme.accentText;
        previewElements.detailLabels.forEach(label => label.style.color = theme.accentText);
        previewElements.eventDate.style.color = theme.secondaryText;
        previewElements.eventTime.style.color = theme.secondaryText;
        previewElements.location.style.color = theme.secondaryText;
        previewElements.room.style.color = theme.secondaryText;
        previewElements.host1Image.style.borderColor = theme.hostBorder;
        previewElements.host2Image.style.borderColor = theme.hostBorder;
    }

    // <<< MODIFIED: applyTheme now takes an `isCommit` flag
    function applyTheme(theme, isCommit = true) {
        if (isCommit) {
            currentTheme = theme; // Update the actual current theme
            document.querySelectorAll('.theme-swatch').forEach(sw => {
                sw.classList.toggle('active-theme', sw.dataset.themeId === theme.id);
            });
            saveFormData(); // Save only when a theme is committed
        }
        _applyThemeStyles(theme); // Always apply/re-apply styles
    }

    themes.forEach(theme => {
        const swatch = document.createElement('div');
        swatch.className = 'theme-swatch';
        swatch.style.backgroundColor = theme.swatchColor;
        swatch.dataset.themeId = theme.id;
        // swatch.title = theme.name; // Native title, can be kept or removed

        // <<< MODIFIED: Event listeners for swatches
        swatch.addEventListener('click', () => {
            applyTheme(theme, true); // Commit this theme
        });

        swatch.addEventListener('mouseover', (event) => {
            _applyThemeStyles(theme); // Temporarily apply hovered theme's styles

            themeNameTooltip.textContent = theme.name;
            themeNameTooltip.style.left = (event.clientX + 10) + 'px';
            themeNameTooltip.style.top = (event.clientY + 10) + 'px';
            themeNameTooltip.classList.remove('hidden');
            themeNameTooltip.style.opacity = 1;
        });

        swatch.addEventListener('mousemove', (event) => {
            // Update tooltip position as mouse moves within the swatch
            themeNameTooltip.style.left = (event.clientX + 10) + 'px';
            themeNameTooltip.style.top = (event.clientY + 10) + 'px';
        });

        swatch.addEventListener('mouseout', () => {
            _applyThemeStyles(currentTheme); // Revert to the styles of the committed currentTheme

            themeNameTooltip.style.opacity = 0;
            // Add a small delay before hiding to allow fade-out
            setTimeout(() => {
                 if (themeNameTooltip.style.opacity == 0) { // Check if still meant to be hidden
                    themeNameTooltip.classList.add('hidden');
                 }
            }, 100); // Should match transition duration
        });

        themeSelectorDiv.appendChild(swatch);
    });

    function updatePreview() {
        previewElements.title.textContent = formInputs.title.value;
        previewElements.subtitle.textContent = formInputs.subtitle.value;
        previewElements.workshopBy.textContent = formInputs.workshopBy.value;
        previewElements.language.textContent = formInputs.language.value;
        previewElements.eventDate.textContent = formInputs.eventDate.value;
        previewElements.eventTime.textContent = formInputs.eventTime.value;
        previewElements.location.textContent = formInputs.location.value;
        previewElements.room.textContent = formInputs.room.value;
        previewElements.signupText.textContent = formInputs.signupText.value;

        const numHosts = formInputs.numHosts.value;
        document.getElementById('host2-details').style.display = numHosts === '2' ? 'block' : 'none';

        previewElements.host1Name.textContent = formInputs.host1Name.value;
        const host1NameTrimmed = formInputs.host1Name.value.trim();
        const host2NameTrimmed = numHosts === '2' ? formInputs.host2Name.value.trim() : "";

        previewElements.withLabel.style.display = (host1NameTrimmed || (numHosts === '2' && host2NameTrimmed)) ? 'block' : 'none';

        if (numHosts === '1') {
            previewElements.host2Name.style.display = 'none';
            previewElements.ampersand.style.display = 'none';
            previewElements.host2Image.style.display = 'none';
            const host1HasContent = host1NameTrimmed || (previewElements.host1Image.src !== placeholderPerson && previewElements.host1Image.src.startsWith('data:image'));
            previewElements.hostImagesContainer.style.display = host1HasContent ? 'flex' : 'none';
            previewElements.host1Image.style.display = host1HasContent ? 'block' : 'none';
        } else {
            previewElements.host2Name.textContent = formInputs.host2Name.value;
            previewElements.host1Name.style.display = host1NameTrimmed ? 'inline' : 'none';
            previewElements.host2Name.style.display = host2NameTrimmed ? 'inline' : 'none';
            previewElements.ampersand.style.display = (host1NameTrimmed && host2NameTrimmed) ? 'inline' : 'none';
            const host1HasContent = host1NameTrimmed || (previewElements.host1Image.src !== placeholderPerson && previewElements.host1Image.src.startsWith('data:image'));
            const host2HasContent = host2NameTrimmed || (previewElements.host2Image.src !== placeholderPerson && previewElements.host2Image.src.startsWith('data:image'));
            previewElements.host1Image.style.display = host1HasContent ? 'block' : 'none';
            previewElements.host2Image.style.display = host2HasContent ? 'block' : 'none';
            previewElements.hostImagesContainer.style.display = (host1HasContent || host2HasContent) ? 'flex' : 'none';
        }
        scalePreview();
        saveFormData();
    }

    function handleImageUpload(fileInput, previewImgElement, placeholder, isLogo = false) {
        if (fileInput.files && fileInput.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImgElement.src = e.target.result;
                if (isLogo) previewElements.logo.classList.remove('hidden');
                updatePreview();
            }
            reader.readAsDataURL(fileInput.files[0]);
        } else {
            previewImgElement.src = placeholder;
            if (isLogo) {
                previewElements.logo.classList.add('hidden');
            }
            updatePreview();
        }
    }

    Object.values(formInputs).forEach(input => {
        if (input.type === 'file') {
            input.addEventListener('change', () => {
                if (input === formInputs.host1Image) handleImageUpload(input, previewElements.host1Image, placeholderPerson);
                else if (input === formInputs.host2Image) handleImageUpload(input, previewElements.host2Image, placeholderPerson);
                else if (input === formInputs.logoImage) handleImageUpload(input, previewElements.logo, placeholderLogo, true);
            });
        } else { input.addEventListener('input', updatePreview); }
    });
    formInputs.numHosts.addEventListener('change', updatePreview);

    function scalePreview() {
        const availableWidth = previewDisplayArea.offsetWidth;
        const nativeWidth = 960;
        bannerScaler.style.height = bannerContent.offsetHeight + 'px';
        if (availableWidth < nativeWidth) {
            const scaleFactor = availableWidth / nativeWidth;
            bannerScaler.style.transform = `scale(${scaleFactor})`;
        } else {
            bannerScaler.style.transform = 'scale(1)';
        }
        const currentScale = parseFloat(bannerScaler.style.transform.replace('scale(','').replace(')','')) || 1;
        previewDisplayArea.style.height = bannerScaler.offsetHeight * currentScale + 'px';
    }
    window.addEventListener('resize', scalePreview);
    const observer = new MutationObserver(scalePreview);
    observer.observe(bannerContent, { childList: true, characterData: true, subtree: true, attributes: true });

            async function generateAndDownload(targetWidthPx, targetHeightPx, platform) {
        // 1. Get data from form inputs
        let dateStr = formInputs.eventDate.value;
        let host1NameStr = formInputs.host1Name.value.trim();
        let host2NameStr = formInputs.host2Name.value.trim();
        let workshopTitleStr = formInputs.title.value.trim();
        const numHostsSelected = formInputs.numHosts.value; // <<< GET THE SELECTED NUMBER OF HOSTS

        // 2. Sanitize function
        function sanitizeForFilename(text) {
            if (!text) return "";
            return text
                .toLowerCase()
                .replace(/\s+/g, '-')
                .replace(/[^\w-]+/g, '')
                .replace(/--+/g, '-')
                .replace(/^-+|-+$/g, '');
        }

        // 3. Format Date (attempt to get YYYY-MM-DD)
        let formattedDate = "event-date";
        try {
            const dateParts = dateStr.split(',');
            if (dateParts.length >= 2) {
                const dateObj = new Date(dateParts[1].trim() + (dateParts[2] ? (', ' + dateParts[2].trim()) : ''));
                if (!isNaN(dateObj.getTime())) {
                    const year = dateObj.getFullYear();
                    const month = (dateObj.getMonth() + 1).toString().padStart(2, '0');
                    const day = dateObj.getDate().toString().padStart(2, '0');
                    formattedDate = `${year}-${month}-${day}`;
                }
            } else {
                 const dateObj = new Date(dateStr.trim());
                 if (!isNaN(dateObj.getTime())) {
                    const year = dateObj.getFullYear();
                    const month = (dateObj.getMonth() + 1).toString().padStart(2, '0');
                    const day = dateObj.getDate().toString().padStart(2, '0');
                    formattedDate = `${year}-${month}-${day}`;
                }
            }
        } catch (e) {
            console.warn("Could not parse date for filename, using default.", e);
            const sanitizedDateStr = sanitizeForFilename(dateStr);
            if (sanitizedDateStr) formattedDate = sanitizedDateStr;
        }

        // Construct host part --- <<< MODIFIED SECTION
        let hostPart = "";
        const sanitizedHost1 = sanitizeForFilename(host1NameStr);
        const sanitizedHost2 = sanitizeForFilename(host2NameStr);

        if (numHostsSelected === '1') {
            if (sanitizedHost1) {
                hostPart = sanitizedHost1;
            }
        } else if (numHostsSelected === '2') {
            if (sanitizedHost1 && sanitizedHost2) {
                hostPart = `${sanitizedHost1}-and-${sanitizedHost2}`;
            } else if (sanitizedHost1) {
                hostPart = sanitizedHost1;
            } else if (sanitizedHost2) {
                hostPart = sanitizedHost2;
            }
        }
        // Fallback if hostPart is still empty (e.g., names were empty even if selected)
        if (!hostPart) hostPart = "host";
        // --- END OF MODIFIED SECTION ---

        // Sanitize workshop title
        let titlePart = sanitizeForFilename(workshopTitleStr) || "workshop-title";

        // 4. Construct the filename
        const filename = `${formattedDate}-${hostPart}-${platform.toLowerCase()}-${titlePart}.png`;
        console.log(`Generated filename: ${filename}`);

        // ... (rest of the function remains the same) ...
        console.log(`Starting download for ${platform} (${targetWidthPx}x${targetHeightPx})`);
        try { await document.fonts.ready; console.log("Fonts ready."); }
        catch (fontError) { console.warn("Error waiting for fonts.ready:", fontError, "Proceeding anyway."); }

        const originalTransform = bannerScaler.style.transform;
        const originalScalerHeight = bannerScaler.style.height;
        const originalDisplayAreaHeight = previewDisplayArea.style.height;
        bannerScaler.style.transform = 'scale(1)';
        bannerScaler.style.height = bannerContent.offsetHeight + 'px';
        await new Promise(resolve => setTimeout(resolve, 200));

        try {
            const canvas = await html2canvas(bannerContent, {
                allowTaint: true, useCORS: true, scale: 2, backgroundColor: null,
                scrollX: 0, scrollY: 0, width: bannerContent.scrollWidth, height: bannerContent.scrollHeight,
                logging: true
            });

            bannerScaler.style.transform = originalTransform;
            bannerScaler.style.height = originalScalerHeight;
            previewDisplayArea.style.height = originalDisplayAreaHeight;

            const finalCanvas = document.createElement('canvas');
            finalCanvas.width = targetWidthPx; finalCanvas.height = targetHeightPx;
            const ctx = finalCanvas.getContext('2d');
            const sWidth = canvas.width;
            const sHeight = canvas.height;

            const sourceAspectRatio = sWidth / sHeight;
            const targetAspectRatio = targetWidthPx / targetHeightPx;

            let sx = 0, sy = 0, cropWidth = sWidth, cropHeight = sHeight;

            if (sourceAspectRatio > targetAspectRatio) {
                cropWidth = sHeight * targetAspectRatio;
                sx = (sWidth - cropWidth) / 2;
            } else if (sourceAspectRatio < targetAspectRatio) {
                cropHeight = sWidth / targetAspectRatio;
                sy = (sHeight - cropHeight) / 2;
            }
            ctx.drawImage(canvas, sx, sy, cropWidth, cropHeight, 0, 0, targetWidthPx, targetHeightPx);

            const link = document.createElement('a');
            link.download = filename;
            link.href = finalCanvas.toDataURL('image/png');
            link.click();
            console.log(`Download ${filename} triggered.`);
        } catch (err) {
            console.error("Error during html2canvas capture or image processing:", err);
            alert("Error generating banner image. Please check console for details.");
            bannerScaler.style.transform = originalTransform;
            bannerScaler.style.height = originalScalerHeight;
            previewDisplayArea.style.height = originalDisplayAreaHeight;
        }
    }

    document.getElementById('downloadFacebookBtn').addEventListener('click', () => {
      generateAndDownload(1920, 1005, 'Facebook'); // Pass 'Facebook' as platform
    });
    document.getElementById('downloadMeetupBtn').addEventListener('click', () => {
      generateAndDownload(1920, 1080, 'Meetup'); // Pass 'Meetup' as platform
    });

    loadFormData();
    applyTheme(currentTheme, true); // <<< MODIFIED: Ensure initial theme is committed
    updatePreview();
    setTimeout(scalePreview, 100);
  });
</script>
</body>
</html>